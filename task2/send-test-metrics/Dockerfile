# =========================
# Используем образ Kafka от Bitnami версии 3.7
# =========================
FROM bitnami/kafka:3.7

# =========================
# Установка дополнительных инструментов
# =========================

# Переключаемся на root-пользователя, так как по умолчанию контейнер работает под непривилегированным пользователем.
USER root

# Устанавливаем утилиту jq для обработки JSON-данных в командной строке.
# После установки очищаем кеш пакетов, чтобы уменьшить размер образа.
RUN apt-get update && apt-get install -y jq && rm -rf /var/lib/apt/lists/*

# =========================
# Копирование вспомогательного скрипта
# =========================

# Копируем скрипт send-test-metrics.sh в контейнер в каталог /opt/scripts/
COPY send-test-metrics.sh /opt/scripts/send-test-metrics.sh

# Делаем скрипт исполняемым
RUN chmod +x /opt/scripts/send-test-metrics.sh

# =========================
# Настройка пользователя и рабочей директории
# =========================

# Переключаемся обратно на непривилегированного пользователя контейнера (1001), 
# используемого в официальном образе Bitnami.
USER 1001

# Устанавливаем рабочую директорию в /opt/scripts/
WORKDIR /opt/scripts

# =========================
# Определение команды запуска контейнера
# =========================

# Запускаем наш скрипт send-test-metrics.sh при старте контейнера.
CMD ["/opt/scripts/send-test-metrics.sh"]
